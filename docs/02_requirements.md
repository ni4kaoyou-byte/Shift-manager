# 02_requirements.md — 要件定義（機能要件 / 非機能要件）+ やる/やらない（MVP固定）

- プロダクト：飲食店向け シフト管理SaaS（個人開発MVP）
- 対象：**1店舗** / 店長（管理者）＋スタッフ（アルバイト）
- このドキュメントの役割：MVPの範囲を固定し、実装と判断のブレを防ぐ
- 更新：v0.1

---

## 0. MVPの成功条件（Definition of Success）

MVPとして「飲食店のシフト管理を成功した」と言える状態：

- 希望回収 → シフト作成 → 公開 → 欠勤/変更対応 が **アプリ内で完結**
- スタッフが **確定シフトを迷わず確認**でき、更新に気づける
- 公開後の変更が **履歴として残る**（揉め防止の最低ライン）

---

## 1. スコープの線引き（最重要：やること / やらないこと）

### ✅ やる（MVPに含める）
- 認証（ユーザー登録/ログイン）
- ロール：店長（管理者）/ スタッフ（一般）
- 店舗参加（招待リンク or コード）
- シフト期間の作成（週単位など）と状態管理（下書き/公開）
- 希望提出（スタッフ）と提出状況（未提出者可視化）
- シフト作成・編集（店長：**手動編集でOK**）
- 公開（確定版を一つにする）
- 欠勤/変更申請（スタッフ）→ 承認/却下（店長）→ シフト反映
- 通知（最低限：メール or アプリ内通知のどちらか）
- 変更履歴（誰が/いつ/何を変更したか）

### ❌ やらない（MVP外）
- 自動シフト最適化（AI/アルゴリズム）
- 代打募集の自動化（候補へ一斉通知→先着→確定）
- 多店舗管理 / エリアマネ / 複数権限階層
- 勤怠打刻・給与計算・会計連携
- 外部カレンダー同期（Google/Apple）
- LINE連携・Push通知（モバイルアプリ前提のもの）
- 高度な分析ダッシュボード
- 厳密な労務ルールエンジン（連勤/休憩/深夜などの完全自動チェック）

---

## 2. 機能要件（Functional Requirements）

> 記法：  
> - FR-xx：機能要件ID  
> - 優先度：Must（MVP必須）/ Should（余裕があれば）/ Could（将来）  
> - 受け入れ条件：最低限の合格基準

---

### 2.1 認証・権限（Auth / RBAC）

**FR-01（Must）ユーザー登録/ログイン**
- ユーザーはメール+パスワード（または同等）で登録・ログインできる
- ログイン状態を維持できる

**受け入れ条件**
- 未ログインは保護ページにアクセスできない
- ログイン後にダッシュボードへ遷移できる

---

**FR-02（Must）ロール（店長/スタッフ）**
- ユーザーは「店長」または「スタッフ」のロールを持つ
- 画面とAPIはロールに応じてアクセス制御される

**受け入れ条件**
- スタッフはシフト編集/公開/履歴閲覧ができない
- 店長は全機能へアクセスできる

---

### 2.2 店舗・招待（Org / Invite）

**FR-03（Must）店舗作成（店長）**
- 店長は店舗（1店舗）を作成できる

**受け入れ条件**
- 店長の初回登録後、店舗が作られていなければ作成導線に誘導される

---

**FR-04（Must）招待リンク/コード（店長）**
- 店長は招待リンクまたは招待コードを発行できる
- スタッフは招待を使って店舗に参加できる

**受け入れ条件**
- 参加後、スタッフは店舗のシフト期間/確定シフトが閲覧できる

---

**FR-05（Should）スタッフ無効化（店長）**
- 店長はスタッフを無効化できる（退職扱い）
- 過去のシフト/履歴は保持される

**受け入れ条件**
- 無効化されたスタッフはログインできても店舗データにアクセスできない（または店舗から外れる）

---

### 2.3 シフト期間（Schedule Period）

**FR-06（Must）シフト期間の作成（店長）**
- 店長は期間（例：1週間）を作成できる
- 期間には開始日/終了日を持つ

**受け入れ条件**
- 期間一覧に表示され、期間詳細へ遷移できる

---

**FR-07（Must）希望提出の締切設定**
- 期間に対して希望提出の締切日時を設定できる

**受け入れ条件**
- 締切後、スタッフは原則編集できない（店長は例外可）

---

**FR-08（Must）期間状態（下書き/公開）**
- 期間は `下書き` / `公開（確定）` の状態を持つ
- 公開された期間はスタッフに「確定版」として見える

**受け入れ条件**
- 公開するとスタッフ画面に表示される
- 下書き状態のシフトはスタッフに見えない（または確定として見えない）

---

### 2.4 希望提出（Availability）

**FR-09（Must）希望提出（スタッフ）**
- スタッフは期間内に希望を提出できる
- 入力は最低限「日ごとに入れる時間帯」or「入れない」を表現できる

**受け入れ条件**
- 提出後、提出内容を確認できる
- 締切前は編集できる

---

**FR-10（Must）提出状況（店長）**
- 店長は提出済み/未提出の一覧を見られる

**受け入れ条件**
- 未提出者が明確に判別できる

---

**FR-11（Should）代理入力（店長）**
- 店長がスタッフの希望を代理入力できる

**受け入れ条件**
- 代理入力したことが分かる（メモ or 履歴）

---

### 2.5 シフト作成・編集（Assignment）

**FR-12（Must）シフト枠の手動編集（店長）**
- 店長は日×時間帯の枠にスタッフを割り当てられる
- 追加/削除/入れ替えができる

**受け入れ条件**
- 期間内で割当が保存され、再表示で保持される

---

**FR-13（Should）必要人数の目安（簡易テンプレ）**
- 曜日×時間帯に「目安人数」を設定できる（簡易でOK）
- 不足/過剰が視覚的に分かる

**受け入れ条件**
- 目安人数に対して割当数が不足している箇所が判別できる

---

### 2.6 公開・閲覧（Publishing）

**FR-14（Must）シフト公開（店長）**
- 店長は期間のシフトを公開（確定）できる

**受け入れ条件**
- 公開後、スタッフが閲覧できる
- 公開後も店長は編集できる（ただし変更履歴が残る）

---

**FR-15（Must）スタッフの確定シフト閲覧**
- スタッフは自分の確定シフトを期間/日別に確認できる

**受け入れ条件**
- 自分に割り当てられた枠が分かる
- 最新の確定版が表示される

---

### 2.7 欠勤/変更（Change Request）

**FR-16（Must）欠勤/変更申請（スタッフ）**
- スタッフは自分の割当枠に対して欠勤/変更を申請できる
- 理由は任意（短文でも可）

**受け入れ条件**
- 申請が店長に見える
- 申請状態（未対応/承認/却下）が分かる

---

**FR-17（Must）申請の承認/却下（店長）**
- 店長は申請を承認/却下できる

**受け入れ条件**
- 承認/却下が申請に反映される
- 承認後に店長が割当編集して反映できる

---

**FR-18（Must）変更のシフト反映**
- 公開後のシフト変更（穴埋め等）を保存し、スタッフに最新が表示される

**受け入れ条件**
- 変更後、スタッフ画面に最新が表示される

---

### 2.8 通知（Notifications）

**FR-19（Must）通知（最低限）**
- 少なくとも以下のイベントで通知される
  - 希望提出の締切が近い（未提出者向け）
  - シフトが公開された
  - 変更が確定した（自分に関係する）

**受け入れ条件**
- メール or アプリ内通知のどちらかで、ユーザーが気づける

---

### 2.9 変更履歴（Audit Log）

**FR-20（Must）変更履歴（公開後の変更は必ず記録）**
- 公開後のシフト変更について「誰が/いつ/何を」を記録する

**受け入れ条件**
- 店長が履歴を一覧で閲覧できる
- 履歴が削除されない（UI上で消せない）

---

## 3. 非機能要件（Non-Functional Requirements）

> 記法：NFR-xx：非機能要件ID

---

### 3.1 セキュリティ

**NFR-01（Must）パスワード保護**
- パスワードはハッシュ化して保存（平文禁止）
- 認証情報は安全に管理する

**NFR-02（Must）アクセス制御**
- 店舗のデータは所属ユーザーのみアクセス可能（テナント分離）
- ロールに応じてAPI/画面アクセスを制限

**NFR-03（Should）基本的な脆弱性対策**
- 入力バリデーション、XSS/CSRF対策、レート制限（ログイン/招待）

---

### 3.2 可用性・信頼性

**NFR-04（Must）DBバックアップ**
- DBの自動バックアップ（日次で可）
- 復元手順をドキュメント化（runbook）

**NFR-05（Must）監査ログの保全**
- 変更履歴は改ざん・誤削除されにくい設計にする（最低限、UIから削除不可）

---

### 3.3 性能（体感ベースでOK）

**NFR-06（Must）主要画面の体感**
- シフト閲覧/編集の表示が体感3秒以内（一般的な通信環境想定）

**NFR-07（Could）同時編集の扱い**
- MVPでは厳密なリアルタイム同期は不要
- 競合は「更新失敗→再読み込み」など簡易で許容

---

### 3.4 UX / 互換性

**NFR-08（Must）モバイル最適**
- スタッフ向け導線はスマホで完結できる

**NFR-09（Should）レスポンシブ**
- 店長向けはPC/タブレットでも操作しやすい

---

### 3.5 運用・監視

**NFR-10（Must）ログ**
- サーバエラーと主要イベント（公開/変更確定/招待）を記録する

**NFR-11（Should）監視**
- 死活（アプリが応答しているか）
- エラーレート（例：5xx増加）を検知できる

---

### 3.6 保守性

**NFR-12（Must）構造が破綻しない最小設計**
- ドメイン境界（店舗/ユーザー/期間/希望/割当/申請/履歴）を意識して実装する
- 仕様変更に備え、重要な判断はADRに残す

---

## 4. 受け入れ条件（E2E：最低1本は通す）

MVPの完了判定として、少なくとも以下のフローが通ること：

1. 店長が登録 → 店舗作成 → 招待発行  
2. スタッフが招待で参加 → 希望提出  
3. 店長が未提出を確認 → シフトを手動作成 → 公開  
4. スタッフが確定シフトを確認  
5. スタッフが欠勤申請 → 店長が承認 → 店長がシフト反映  
6. スタッフが更新を確認（通知 or アプリ内）

---

## 5. 将来拡張（参考：MVP後の候補）

- 代打募集（候補へ通知・先着/承認制）
- スキル/ポジション（ホール/キッチン）と配置ルール
- 多店舗管理、オーナー向け分析
- LINE/Push/カレンダー連携
- 労務ルールの自動チェック強化
