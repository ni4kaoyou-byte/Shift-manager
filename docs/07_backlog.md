# 07_backlog.md — 実装バックログ（API先行 / 縦スライス）

- プロダクト：飲食店向け シフト管理SaaS（個人開発MVP）
- 方針：**API先行 + 画面並行実装（モック禁止）**
- 優先順：**ログイン → 参加 → 希望提出 → 公開 → 変更申請 → 履歴**
- 更新：v0.1

---

## 0. 運用ルール

- レーンは `Now / Next / Later / Done` を使う
- 優先度は `P0 > P1 > P2`
- 1チケットは原則1〜2日で完了できる粒度に分割する
- 画面実装時は必ず実APIに接続する（モックデータは禁止）
- 完了条件（Definition of Done）
  - 受け入れ条件を満たす
  - 手動E2Eで対象フローが通る
  - エラー時の挙動（認可/バリデーション）が確認済み

---

## 1. マイルストーン

### M0: 開発基盤

- 環境構築と土台API/土台Webを整える

### M1: ログイン（Auth）

- ログインしてロール付きでトップ画面に到達できる

### M2: 参加（Membership/Invite）

- 店長が招待を発行し、スタッフが参加できる

### M3: 希望提出（Availability）

- スタッフが希望提出し、店長が提出状況を見られる

### M4: 公開（Period/Assignment）

- 店長が割当編集して公開し、スタッフに確定版が見える

### M5: 変更申請（Change Request）

- スタッフ申請→店長承認/却下→割当反映ができる

### M6: 履歴（Audit Log）

- 公開後変更の履歴を店長が確認できる

---

## 2. Now（最優先）

### BL-001 環境構築: リポジトリ骨組み作成

- 優先度: P0
- 種別: Setup
- 依存: なし
- 内容
  - `apps/api` と `apps/web` のディレクトリ作成
  - `db/`, `docs/` との責務境界を明記
  - ルートREADMEに起動手順の下書き作成
- 受け入れ条件
  - ディレクトリ構成が `docs/06_architecture.md` と一致する

### BL-002 環境構築: 開発ツール統一

- 優先度: P0
- 種別: Setup
- 依存: BL-001
- 内容
  - Go/Node/npm のバージョン方針を固定
  - APIの `Makefile`（`run`, `test`, `lint`）作成
  - Webの `package scripts`（`dev`, `build`, `test`）作成
- 受け入れ条件
  - 初回セットアップ手順だけでAPI/Webがローカル起動できる

### BL-003 環境構築: 設定・シークレット管理

- 優先度: P0
- 種別: Setup
- 依存: BL-002
- 内容
  - `.env.example`（api/web）を作成
  - 必須環境変数（Supabase URL/JWT/DB接続）を定義
  - `config` ローダをAPI側に実装
- 受け入れ条件
  - 環境変数不足時にAPIが明確なエラーで起動失敗する

### BL-004 環境構築: DB初期化運用

- 優先度: P0
- 種別: Setup
- 依存: BL-003
- 内容
  - `db/migrations/0001_init` を適用する運用手順を確定
  - `db/schema.sql` とmigration同期ルールをREADME化
  - sqlc生成コマンドを整備
- 受け入れ条件
  - 空DBからmigration適用→sqlc生成が再現可能

### BL-005 API骨組み: ginサーバ初期化

- 優先度: P0
- 種別: API
- 依存: BL-004
- 内容
  - `cmd/server` に起動処理実装
  - `/healthz` と `/api/v1` のルーティング土台作成
  - 共通ミドルウェア（request id, logging, recover）追加
- 受け入れ条件
  - サーバ起動し、`/healthz` が200を返す

### BL-006 API骨組み: モジュール雛形作成

- 優先度: P0
- 種別: API
- 依存: BL-005
- 内容
  - 下記モジュールの `handler/usecase/repository` 雛形作成
  - `auth`, `membership`, `period`, `availability`, `assignment`, `change_request`, `audit_log`
- 受け入れ条件
  - 各モジュールがコンパイル通過し、DI配線済み

### BL-007 Web骨組み: Reactアプリ初期化

- 優先度: P0
- 種別: Web
- 依存: BL-002
- 内容
  - `app/features/shared` のfeature-based構造作成
  - ルーティングと認証ガード土台作成
  - APIクライアント（JWT添付）実装
- 受け入れ条件
  - 画面遷移とAPI通信基盤が動作する

---

## 3. Next（縦スライス順）

### Flow 1: ログイン（Auth）

### BL-101 API: 認証ミドルウェアと `/me`

- 優先度: P0
- 種別: API
- 依存: BL-006
- 関連: FR-01, FR-02 / UX-01, UX-04
- 内容
  - Supabase JWT検証
  - ロール/所属を返す `/api/v1/me`
- 受け入れ条件
  - 未ログイン401、ログイン済みでユーザー情報を返す

### BL-102 Web: ログイン画面（実接続）

- 優先度: P0
- 種別: Web
- 依存: BL-101, BL-007
- 関連: FR-01 / UX-01
- 内容
  - ログインフォーム実装
  - ログイン後 `/me` 取得でロール別遷移
- 受け入れ条件
  - 正常ログイン/失敗時エラー表示/保護ルート制御

### Flow 2: 参加（Membership/Invite）

### BL-201 API: 招待発行・参加

- 優先度: P0
- 種別: API
- 依存: BL-101
- 関連: FR-03, FR-04 / UX-02, UX-03
- 内容
  - 招待コード発行API（店長のみ）
  - 招待コード参加API（スタッフ）
  - `store_memberships` 作成処理
- 受け入れ条件
  - 店長のみ招待作成可、参加後に所属が作成される

### BL-202 Web: 参加導線（登録/招待）

- 優先度: P0
- 種別: Web
- 依存: BL-201
- 関連: FR-03, FR-04 / UX-02, UX-03
- 内容
  - 店長の店舗作成導線
  - スタッフの招待コード参加画面
- 受け入れ条件
  - 参加完了後、ダッシュボードに遷移する

### Flow 3: 希望提出（Availability）

### BL-301 API: 期間作成/提出状況/希望提出

- 優先度: P0
- 種別: API
- 依存: BL-201
- 関連: FR-06, FR-07, FR-09, FR-10 / UX-05, UX-06, UX-07
- 内容
  - 期間作成API（店長）
  - 提出状況取得API（店長）
  - 希望提出/更新API（スタッフ）
- 受け入れ条件
  - 締切前のみ提出更新可、締切後は更新不可

### BL-302 Web: 期間一覧/期間詳細/希望提出

- 優先度: P0
- 種別: Web
- 依存: BL-301
- 関連: FR-06, FR-07, FR-09, FR-10 / UX-05, UX-06, UX-07
- 内容
  - 店長の期間一覧・詳細
  - スタッフの希望提出画面
- 受け入れ条件
  - 提出完了が店長画面の提出状況に即時反映される

### Flow 4: 公開（Assignment/Period）

### BL-401 API: 割当編集と公開

- 優先度: P0
- 種別: API
- 依存: BL-301
- 関連: FR-12, FR-14, FR-15, FR-18 / UX-08, UX-09
- 内容
  - 割当CRUD（店長）
  - 期間公開API
  - スタッフ向け確定シフト取得API
- 受け入れ条件
  - 公開後、スタッフは最新確定シフトを取得できる

### BL-402 Web: シフト編集/確定シフト閲覧

- 優先度: P0
- 種別: Web
- 依存: BL-401
- 関連: FR-12, FR-14, FR-15 / UX-08, UX-09
- 内容
  - 店長の割当編集UI
  - スタッフの確定シフト閲覧UI
- 受け入れ条件
  - 公開操作後にスタッフ画面へ即反映される

### Flow 5: 変更申請（Change Request）

### BL-501 API: 変更申請/承認却下

- 優先度: P0
- 種別: API
- 依存: BL-401
- 関連: FR-16, FR-17, FR-18 / UX-10, UX-11
- 内容
  - 変更申請作成API（スタッフ）
  - 申請一覧/承認/却下API（店長）
  - 承認後の割当更新トランザクション
- 受け入れ条件
  - 申請状態が正しく遷移し、最新割当へ反映できる

### BL-502 Web: 申請画面/申請管理画面

- 優先度: P0
- 種別: Web
- 依存: BL-501
- 関連: FR-16, FR-17 / UX-10, UX-11
- 内容
  - スタッフの申請フォームと状態表示
  - 店長の承認/却下UI
- 受け入れ条件
  - 承認/却下結果が双方画面に反映される

### Flow 6: 履歴（Audit Log）

### BL-601 API: 監査ログ記録と履歴取得

- 優先度: P0
- 種別: API
- 依存: BL-401, BL-501
- 関連: FR-20 / UX-11
- 内容
  - 公開、公開後割当変更、承認/却下で `audit_logs` 記録
  - 履歴一覧取得API（店長のみ）
- 受け入れ条件
  - 主要イベントの履歴が時系列で取得できる

### BL-602 Web: 履歴表示

- 優先度: P0
- 種別: Web
- 依存: BL-601
- 関連: FR-20 / UX-11
- 内容
  - 変更履歴一覧画面
  - イベント種別・対象・実行者・日時の表示
- 受け入れ条件
  - 店長のみ閲覧可能、スタッフはアクセス不可

---

## 4. Later（MVP後 / Should項目）

### BL-701 必要人数テンプレ（coverage_targets）

- 優先度: P1
- 関連: FR-13 / UX-08

### BL-702 店長による代理入力

- 優先度: P1
- 関連: FR-11 / UX-06

### BL-703 スタッフ無効化

- 優先度: P1
- 関連: FR-05

### BL-704 通知強化（締切リマインド自動化）

- 優先度: P1
- 関連: FR-19

---

## 5. Done

- なし（このファイル作成時点）
